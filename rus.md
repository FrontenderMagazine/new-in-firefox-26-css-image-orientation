# В Firefox 26 появилась поддержка ориентации изображений с помощью CSS

Делиться цифровыми фотографиями через веб сейчас, благодаря современным смартфонам
и цифровым камерам, просто как никогда. Однако для веб-разработчиков работа с
пользовательскими цифровыми изображениями может быть совсем непростой. Существует
ощутимая разница между вебом, в котором ориентация изображения определяется тем,
как сохранены пиксели внутри формата, — и цифровой фотографией, в которой пиксели
хранятся в одной и той же ориентации, а в метаданных размечен угол поворота
изображения.

На практике это означает, что пользователь видит вот это:

![With EXIF][1]

Когда должен увидеть вот это:

![Correct orientation][2]

В реальности изображения, о которых идет речь — как правило, JPEG-изображения, а
метаданные — тэги ориентации EXIF. Текущие релизы Firefox не поддерживают
EXIF-ориентации. Chrome и Safari поддерживают ее, если вы открываете только
изображение, но не поддерживают внутри HTML-документа. Это значит, что
веб-разработчикам, которые хотели бы, чтобы фотографии, которые их пользователи
сделали на отдыхе, не отображались повернутыми вбок, приходится выбирать из
нескольких решений, у каждого из которых есть минусы.
[Поворачивать изображение с помощью canvas][3] довольно неэффективно.
[Применение CSS-трансформацию для поворота изображения][4] очень сильно запутывает
верстку документа. А [решения][5]–[на стороне][6] [сервера][7] требуют дополнительной
работы разработчика и не работают для изображений, которые находятся на внешнем
сервере.

Исправление: Оказывается, что _есть_ один браузер, который по умолчанию поддерживает
EXIF-тэг ориентации в HTML-документах: Mobile Safari. (И, соответственно, другие
браузеры на iOS, испольюзующие тот же движок: Chrome и т.п.) Это очень интересно,
потому что это поведение не соответствует стандартам и десктопной версии браузера.

## CSS спешит на помощь

Все эти проблемы решаются новым свойством CSS: [image-orientation][8], который
теперь поддерживается в Firefox 26. Когда к JPEG-изображению применяется стиль
`image-orientation: from-image`, браузер смотрит на его EXIF-тэг ориентации,
когда выполняет развертку и рендеринг. Это значит, что изображения со смартфонов
и цифровых камер теперь могут отображаться в браузере в правильной ориентации.
Для этого нужно просто добавить одно свойство в CSS!

Итак, вот снова первое изображение из этой статьи, но теперь к нему применен
CSS-стиль `image-orientation`. Если вы пользуетесь Firefox 26, то увидите, то
это изображение отображается ровно так, как должно: небо наверху, земля внизу.

    <img style="image-orientation: from-image" src="fountain.jpg">

![With EXIF][1]

Еще один способ использовать `image-orientation` — точно определить ориентацию.
Можно указать значение угла, чтобы повернуть изображение на любое значение,
кратное 90°:

    image-orientation: 270deg;

Кроме того, в этом синтаксисе может присутствовать горизонтальное отражение:

    image-orientation: 270deg flip;

Особенно приятно, что порядок, в котором указаны угол поворота изображения и
отражение применяются в том порядке, в каком они указаны. Также можно использовать
`flip` сам по себе, и тогда он будет значит то же самое, что `0deg flip`.

Когда вы указываете ориентацию вручную, `image-orientation` дает CSS те же самые
возможности, что и тэг ориентации в EXIF. Это можно использовать для того, чтобы
вручную скорректировать отображение JPEG-файлов, в которых нет EXIF-данных,
переориентировать PNG и другие типы изображений, в которых не поддерживается
информация об ориентации.

Свойство `image-orientation` наследуется — это полезно, когда вы хотите применить
ориентацию к изображением внутри сгенерированного контента внутри псевдоэлементов
`:before`/`:after`. К таким изображениям нельзя применять стили напрямую, но так
как они наследуют стили от того элемента, к которому прикреплены, все-таки можно
использовать `image-orientation`.

    <style>
      p:before { content: url(bullet.png); }
      p.ninety { image-orientation: 90deg; }
    </style>

    <p>Изображение через сгенерированный контент с ориентацией по умолчанию.</p>
    <p class="ninety">Изображение через сгенерированный контент, повернутое на 90°.</p>

## Проблемы

Все это здорово, но еще есть несколько сложных мест, о которых нужно знать при
использовании `image-orientation`. Самое очевидное: сейчас оно поддерживается
только в Firefox 26, хотя есть надежда, что это довольно быстро изменится. Но
даже по мере того, как все больше браузеров буду поддерживать это свойство, все
равно есть несколько вещей, на которые нужно обратить внимание.

Пока `image-orientation` не поддерживается всеми браузерами, нужно быть
осторожными с тем, как оно влияет на верстку страницы. Поворот изображения на
разные углы может привести к тому, что размер изображения изменится (если оно не
квадратное), поскольку его ширина и высота поменяются местами. Это может заставить
измениться и верстку вокруг изображения. Скорее всего, `image-orientation` будет
применяться к загруженным пользователем изображениям, поэтому вряд ли это сломает
вашу верстку. Но тем не менее имейте это в виду.

Более тонкий момент: на медленном соединении загрузка больших изображений может
стать проблемой для пользователя. Пользователи привыкли, что такие изображения
начинают появляться сверху. Но при использовании `image-orientation` может
получиться так, что первые пиксели, которые браузер может отобразить, появятся
сбоку или снизу изображения. Если изображение достаточно большое и выходит за
нижний край окна браузера пользователя, он может не понять, что изображение
загружается. Это нужно принимать во внимание, чтобы сделать хороший
пользовательский интерфейс.

Наконец, важно иметь в виду, что `image-orientation` применяется только к
изображениям внутри контента. То есть нельзя использовать его с другими
CSS-свойствами, принимающими изображения как аргументы — `background-image`
или `list-style-image` — оно работает только для  `<img>` и сгенерированного
контента.

## Попробуйте сегодня!

Уже сегодня можно попробовать использовать `image-orientation` в [Firefox Nightly][9].
Если вы предпочитаете не жить прямо на самых новых версиях, то с 17 сентября
`image-orientation` будет поддерживаться в [Firefox Aurora][10].

Внутри Mozilla это свойство уже оказалось для нас очень полезным. Теперь Firefox
отображает отдельные изображения с учетом EXIF-ориентации. Это значит, что при
открытии JPEG-изображения наконец-то результат будет одинаковым и в Firefox, и в
Chrome, и в Safari. Новая версия Thunderbird тоже будет поддерживать
`image-orientation`, чтобы изображения в приложениях к письмам отображались так,
как они должны показываться, и мы надеемся использовать это свойство и в
фотогалерее на Firefox OS.

По мере того, как `image-orientation` становится более распространенной, надеюсь,
что это свойство чуть-чуть облегчит жизнь и веб-разработчикам, и пользователям
интернета. Я очень надеюсь, что наступит тот день, когда навсегда останутся в
прошлом все те случаи, когда мне приходилось поворачивать голову, чтобы посмотреть
на чью-то неправильно повернутую картинку на смартфоне!

   [1]: img/fountain-with-exif.jpg
   [2]: img/fountain.jpg
   [3]: http://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side
   [4]: http://stackoverflow.com/questions/10810496/adjusting-parent-element-of-css-transformed-image-to-fit-twitter-bootstrap
   [5]: http://php.net/manual/en/book.exif.php
   [6]: http://exifr.rubyforge.org/api/
   [7]: http://drupalcontrib.org/api/drupal/contributions!imagecache_actions!autorotate!imagecache_autorotate.module/function/imagecache_autorotate_image/6
   [8]: http://dev.w3.org/csswg/css-images/#the-image-orientation
   [9]: http://nightly.mozilla.org/
   [10]: http://www.mozilla.org/en-US/firefox/aurora/
